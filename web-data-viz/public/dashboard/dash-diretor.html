<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | EyesAnalytic</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600&display=swap" rel="stylesheet"> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../css/pages/dash-diretor.css">
    <link rel="stylesheet" href="../css/pages/aside-menu.css">
    <script src="../js/aside-menu.js"></script>
    <link rel="shortcut icon" href="../assets/svg/Logo.svg" type="image/x-icon">
    <script src="../js/sessao.js"></script>

</head>

<body onabort=" iniciarAtualizacao()" onload="validarSessao()">
   
  <aside id="aside-menu">
        <img src="../assets/svg/Logo.svg" alt="Logo" class="asideLogo">

        <ul id="navLinks">
       
            <a href="../lista-alertas.html" class="outros">
                <li>
                    <img src="../assets/svg/alert-svgrepo-com.svg" alt="Alerta">
                    <span>Alertas</span>
                </li>
            </a>

            <a href="./dash-diretor.html" class="outros">
                <li>
                    <img src="../assets/svg/dashboard-svgrepo-com.svg" alt="Dashboard">
                    <span>Dashboard</span>
                </li>
            </a>

            <a href="../espec-servidores.html" class="outros">
                <li>
                    <img src="../assets/svg/servidor.svg" alt="Rede">
                    <span>Servidores</span>
                </li>
            </a>

            <a href="../funcionario-diretor.html" class="outros">
                <li>
                    <img src="../assets/svg/user-svgrepo-com.svg" alt="Usuário">
                    <span>Funcionários</span>
                </li>
            </a>

            <a href="../metricas-diretor.html" class="outros">
                <li>
                    <img src="./assets/svg/chamados.svg" alt="Chamados">
                    <span>Métricas</span>
                </li>
            </a>

            <a href="../dashboard-cpu-diretor.html" class="outros">
                <li>
                    <img src="./assets/svg/chamados.svg" alt="Chamados">
                    <span>Uso CPU</span>
                </li>
            </a>

            <a onclick="limparSessao()" class="outros">
                <li >
                    <img src="../assets/svg/exit-svgrepo-com.svg" alt="Saída">
                    <span>Sair</span>
                </li>
            </a>

        </ul>
        <div class="menu" id="menu-hamburguer">
            <div class="menu" id="menu-hamburguer">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="80px" height="10px"
                    class="hamburger-line">
                    <rect x="0" y="8" width="600" height="10" fill="white"></rect> <!-- Aumentar a altura aqui -->
                </svg>

                <!-- Linha 2 -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="80px" height="10px"
                    class="hamburger-line">
                    <rect x="0" y="24" width="600" height="10" fill="white"></rect> <!-- Aumentar a altura aqui -->
                </svg>

                <!-- Linha 3 -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="80px" height="10px"
                    class="hamburger-line">
                    <rect x="0" y="40" width="600" height="10" fill="white"></rect> <!-- Aumentar a altura aqui -->
                </svg>
            </div>

        </div>

        </div>
    </aside>
    <div id="fade" class="hide"></div>

    <main>
        <header class="barraSuperior">
            <div class="numPerct">
                <p class="titlePcrt">Quantidade Máquina</p>
                <p class="nmrPcrt">10</p>
            </div>
            <div class="numPerct">
                <p class="titlePcrt">Máquinas Conectadas</p>
                <p class="nmrPcrt">7</p>
            </div>
            <div class="numPerct">
                <p class="titlePcrt">Alertas Recentes</p>
                <p class="nmrPcrt">3</p>
            </div>
            <div class="numPerct">
                <p class="titlePcrt">Mbps de Upload</p>
                <p class="nmrPcrt">9.5</p>
            </div>
            <div class="numPerct">
                <p class="titlePcrt">Mbps de Download</p>
                <p class="nmrPcrt">9.5</p>
            </div>

        </header>
        
        <section class="dash">
            <article class="topoGrafico">
                <h3>Uso médio dos Componentes</h3>
                <div class="botoesGrafico">
                    <div class="periodo" id="periodo">
                        <select class="opcao" id="funcionario">
                            <option disabled selected value="">Semanal</option>
                            <option value="">Mensal</option>
                            <option value="">Bimestral</option>
                            <option value="">Semestral</option>
                        </select>
                      
                        
                        <!-- Semanal <i class="fas fa-chevron-down" id="seta"></i> Ícone de seta -->
                    </div>
                    <!-- <ul id="dropdown" class="dropdown hide">
                        <li class="option">Mensal</li>
                        <li class="option">Bimestral</li>
                        <li class="option">Semestral</li>
                    </ul> -->
                    
                    <div class="componentes" id="componentes">
                        <select class="opcao" id="funcionario">
                            <option disabled selected value="">CPU</option>
                            <option value="">Disco</option>
                            <option value="">Memória</option>
                            <option value="">Rede</option>
                        </select>
                      
                        <!-- CPU <i class="fas fa-chevron-down" id="seta"></i> 
                    </div>
                    <ul id="componentesDropdown" class="dropdown hide">
                        <li class="option">Disco</li>
                        <li class="option">Memória RAM</li>
                        <li class="option">Rede</li> -->
                        <!-- <li class="option">Rede</li> -->
                    </ul>
                    
                        
                    
                </div>
            </article>
            <div class="grafico">
                <canvas id="myChartCanvas" class="canvas"></canvas>
                
                
            </div>
            
        </section>

        <section class="chamados"></section>
            <!-- <article class="alertas">
                <h2>Alertas Recentes</h2>
                <div class="frameAlertas">
                    <div class="userImg">
                        <img src="../assets/svg/alerta.svg" alt="" class="iconAlerta">
                    </div>
                    <p><span class="status-alerta">Alerta CPU</span></p>
                    <p>Status: <span class="status-ativo">Ativo</span></p>
                    <p>Responsável: Fernando Silva</p>
                    <div class="hrDt">
                        <p>12:13</p>
                        <p>20/09/2024</p>
                    </div>

                </div>
                <div class="frameAlertas">
                    <div class="userImg">
                        <img src="../assets/svg/alerta.svg" alt="" class="iconAlerta">
                    </div>
                    <p><span class="status-alerta">Alerta CPU</span></p>
                    <p>Status: <span class="status-ativo">Ativo</span></p>
                    <p>Responsável: Fernando Silva</p>
                    <div class="hrDt">
                        <p>12:13</p>
                        <p>20/09/2024</p>
                    </div>

                </div>
                <div class="frameAlertas">
                    <div class="userImg">
                        <img src="../assets/svg/alerta.svg" alt="" class="iconAlerta">
                    </div>
                    <p><span class="status-alerta">Alerta CPU</span></p>
                    <p>Status: <span class="status-ativo">Ativo</span></p>
                    <p>Responsável: Fernando Silva</p>
                    <div class="hrDt">
                        <p>12:13</p>
                        <p>20/09/2024</p>
                    </div>

                </div>

            </article> -->
        </section>

 

        
    </main>
</body>

</html>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const menuHamburguer = document.getElementById('menu-hamburguer');
        const navLinks = document.getElementById('navLinks');

        // Alterna a classe "active" no menu de navegação
        menuHamburguer.addEventListener('click', () => {
            console.log("EU ESTOU OBSERVANDO..")
            navLinks.classList.toggle('active');
            menuHamburguer.classList.toggle('open');
        });

        // Iniciar a plotagem do gráfico quando a página carregar
        iniciarAtualizacao();
    });

    // Função para iniciar a atualização do gráfico e definir o intervalo de 2 minutos
    function iniciarAtualizacao() {
        obterDadosGrafico().then(() => {
            setInterval(obterDadosGrafico, 120000); // Atualiza a cada 2 minutos
        });
    }

    // Função para obter dados do gráfico
    async function obterDadosGrafico() {
        try {
            let response = await fetch("/captura/capturar", { method: "GET" });
            if (response.ok) {
                let json = await response.json();
                plotarGrafico(json);
            } else {
                let texto = await response.text();
                console.error("Houve um erro ao tentar realizar o obterDadosGrafico!", texto);
            }
        } catch (erro) {
            console.error(erro);
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
    // Defina quantos valores você deseja gerar
    const quantidadeValores = 10;
    const valores = [];
    const labels = [];

    // Gera valores aleatórios para o gráfico
    for (let i = 0; i < quantidadeValores; i++) {
        const valorAleatorio = Math.random() * 100; // Gera um valor aleatório entre 0 e 100
        valores.push(valorAleatorio.toFixed(2)); // Adiciona o valor no array
        labels.push(`Label ${i + 1}`); // Cria um label (pode ser a data ou algo mais específico)
    }

    // Pega o contexto do canvas onde o gráfico será renderizado
    const ctx = document.getElementById('myChartCanvas').getContext('2d');

    // Configuração do gráfico
    const config = {
        type: 'line', // Define o tipo de gráfico (linha)
        data: {
            labels: labels, // Usa os labels gerados
            datasets: [{
                label: 'Uso de CPU (%)', // Título do gráfico
                data: valores, // Dados gerados aleatoriamente
                borderWidth: 4,
                borderColor: '#08836A',
                backgroundColor: '#ffff',
                
            }]
        },
         options: {
        scales: {
            x: {
                grid: {
                    color: 'black', // Cor da linha do eixo X
                },
                ticks: {
                    color: 'black' // Cor dos rótulos do eixo X
                }
            },
            y: {
                beginAtZero: true, // Faz o gráfico começar em 0 no eixo Y
                grid: {
                    color: 'black', // Cor da linha do eixo Y
                },
                ticks: {
                    color: 'black' // Cor dos rótulos do eixo Y
                }
            }
        },
            plugins: {
                legend: {
                    labels: {
                        color: '#000',
                        font: {
                            size: 14
                        }
                    }
                }
            }
        }
    };

    // Renderiza o gráfico usando Chart.js
    new Chart(ctx, config);
});

// Abrir e fechar o dropdown ao clicar na div "periodo"
document.getElementById("periodo").addEventListener("click", function (event) {
    var dropdown = document.getElementById("dropdown");
    dropdown.classList.toggle("hide"); // Alterna entre esconder e mostrar o dropdown
    event.stopPropagation(); // Impede que o clique na div seja considerado um clique fora dela
});

// Fechar o dropdown ao clicar fora da div "periodo" ou do menu
document.addEventListener("click", function () {
    var dropdown = document.getElementById("dropdown");
    dropdown.classList.add("hide"); // Fecha o dropdown se clicar fora
});

// Detectar quando o usuário seleciona uma opção do dropdown
document.querySelectorAll("#dropdown .option").forEach(function (item) {
    item.addEventListener("click", function () {
        var selectedText = this.textContent;

        // Atualiza o texto dentro da div "periodo"
        var periodoDiv = document.getElementById("periodo");
        var currentText = periodoDiv.textContent;

        // Atualiza a lista de opções
        this.textContent = currentText; // A opção selecionada vira a anterior
        periodoDiv.textContent = selectedText; // Atualiza a div com a nova opção selecionada

        // Fecha o dropdown após a seleção
        document.getElementById("dropdown").classList.add("hide");
    });
});

// *** Repetindo o mesmo para os "Componentes" ***

// Abrir e fechar o dropdown ao clicar na div "componentes"
document.getElementById("componentes").addEventListener("click", function (event) {
    var dropdown = document.getElementById("componentesDropdown");
    dropdown.classList.toggle("hide"); // Alterna entre esconder e mostrar o dropdown
    event.stopPropagation(); // Impede que o clique na div seja considerado um clique fora dela
});

// Fechar o dropdown ao clicar fora da div "componentes" ou do menu
document.addEventListener("click", function () {
    var dropdown = document.getElementById("componentesDropdown");
    dropdown.classList.add("hide"); // Fecha o dropdown se clicar fora
});

// Detectar quando o usuário seleciona uma opção do dropdown "componentes"
document.querySelectorAll("#componentesDropdown .option").forEach(function (item) {
    item.addEventListener("click", function () {
        var selectedText = this.textContent;

        // Atualiza o texto dentro da div "componentes"
        var componentesDiv = document.getElementById("componentes");
        var currentText = componentesDiv.textContent;

        // Atualiza a lista de opções
        this.textContent = currentText; // A opção selecionada vira a anterior
        componentesDiv.textContent = selectedText; // Atualiza a div com a nova opção selecionada

        // Fecha o dropdown após a seleção
        document.getElementById("componentesDropdown").classList.add("hide");
    });
});
</script>