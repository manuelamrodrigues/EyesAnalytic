<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | EyesAnalytic</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600&display=swap" rel="stylesheet"> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../css/pages/dash-diretor.css">
    <link rel="stylesheet" href="../css/pages/aside-menu.css">
    <link rel="stylesheet" href="../css/pages/individual-joao.css">
    <script src="../js/aside-menu.js"></script>
    <link rel="shortcut icon" href="../assets/svg/Logo.svg" type="image/x-icon">
    <script src="../js/sessao.js"></script>

</head>
<!-- onload="validarSessao()" -->
<body onabort=" iniciarAtualizacao()" onload="obterDadosGrafico()" onload="validarSessao()" >
   
  <aside id="aside-menu">
        <img src="../assets/svg/Logo.svg" alt="Logo" class="asideLogo">

        <ul id="navLinks">
       
            <a href="../lista-alertas.html" class="outros">
                <li>
                    <img src="../assets/svg/alert-svgrepo-com.svg" alt="Alerta">
                    <span>Alertas</span>
                </li>
            </a>

            <a href="./dash-diretor.html" class="outros">
                <li>
                    <img src="../assets/svg/dashboard-svgrepo-com.svg" alt="Dashboard">
                    <span>Dashboard</span>
                </li>
            </a>

            <a href="../espec-servidores.html" class="outros">
                <li>
                    <img src="../assets/svg/servidor.svg" alt="Rede">
                    <span>Servidores</span>
                </li>
            </a>

            <a href="../funcionario-diretor.html" class="outros">
                <li>
                    <img src="../assets/svg/user-svgrepo-com.svg" alt="Usuário">
                    <span>Funcionários</span>
                </li>
            </a>

            <a href="../metricas-diretor.html" class="outros">
                <li>
                    <img src="./assets/svg/chamados.svg" alt="Chamados">
                    <span>Métricas</span>
                </li>
            </a>

            <a onclick="limparSessao()" class="outros">
                <li >
                    <img src="../assets/svg/exit-svgrepo-com.svg" alt="Saída">
                    <span>Sair</span>
                </li>
            </a>

        </ul>
        <div class="menu" id="menu-hamburguer">
            <div class="menu" id="menu-hamburguer">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="80px" height="10px"
                    class="hamburger-line">
                    <rect x="0" y="8" width="600" height="10" fill="white"></rect> <!-- Aumentar a altura aqui -->
                </svg>

                <!-- Linha 2 -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="80px" height="10px"
                    class="hamburger-line">
                    <rect x="0" y="24" width="600" height="10" fill="white"></rect> <!-- Aumentar a altura aqui -->
                </svg>

                <!-- Linha 3 -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="80px" height="10px"
                    class="hamburger-line">
                    <rect x="0" y="40" width="600" height="10" fill="white"></rect> <!-- Aumentar a altura aqui -->
                </svg>
            </div>

        </div>

        </div>
    </aside>
    <div id="fade" class="hide"></div>

    <main>
        
        
        <section class="dash">
            <article class="supTela">
                <h3>Central de alertas</h3>
                
            </article>
            <div class="grafico">
                <canvas id="myChartCanvas1" width="400" height="200"></canvas>
                
                
            </div>
            
        </section>
        
    </main>
</body>

</html>

<script>
    document.addEventListener("DOMContentLoaded", () => {
    const menuHamburguer = document.getElementById('menu-hamburguer');
    const navLinks = document.getElementById('navLinks');

    // Alterna a classe "active" no menu de navegação
    menuHamburguer.addEventListener('click', () => {
        console.log("EU ESTOU OBSERVANDO..")
        navLinks.classList.toggle('active');
        menuHamburguer.classList.toggle('open');
    });
});


function obterDadosGrafico() {

    fetch(`/avisos/ultimas`, { cache: 'no-store' }).then(function (response) {
    if (response.ok) {
        response.text().then(function (text) {
            console.log(`Resposta bruta: ${text}`);
            try {
                let resposta = JSON.parse(text); // Tenta converter a resposta para JSON
                console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                resposta.reverse();
                // Continue com o restante do código...
            } catch (error) {
                console.error('Erro ao analisar JSON:', error.message);
            }
        });
    } else {
        console.error(`Erro na resposta da API: ${response.status} - ${response.statusText}`);
    }
}).catch(function (error) {
    console.error(`Erro de comunicação com a API: ${error.message}`);
});

}


function plotarGrafico(resposta) {

console.log('iniciando plotagem do gráfico...');

const freq = resposta.map((registros) => registros.totalAlertas);
const recursos = resposta.map((registros) => registro.nomeRecurso);

// Criando estrutura para plotar gráfico - labels
let labels = [];

// Criando estrutura para plotar gráfico - dados
let dados = {
    labels: recursos,
    datasets: [{ 
        label: 'Frequência de Alertas',
        data: freq,
        backgroundColor: "#00000",
        fill: false,
        tension: 0.1
    }]
};


console.log('----------------------------------------------')
console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
console.log(resposta)



console.log('----------------------------------------------')
console.log('O gráfico será plotado com os respectivos valores:')
console.log('Labels:')
console.log(labels)
console.log('Dados:')
console.log(dados.datasets)
console.log('----------------------------------------------')

// Criando estrutura para plotar gráfico - config
const config = {
    type: 'bar',
    data: dados,
};

// Adicionando gráfico criado em div na tela
let myChart = new Chart(
    document.getElementById(`myChartCanvas1`),
    config
);

}

 </script>