<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funcionários | EyesAnalytic</title>
    <!-- <link rel="stylesheet" href="../css/style.css"> -->
    <link rel="stylesheet" href="./css/pages/lista-funcionario-diretor.css">
    <link rel="stylesheet" href="./css/pages/aside-menu.css">
    <link rel="shortcut icon" href="./assets/svg/Logo.svg" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body onload="listarFuncionarios()">
    <aside id="aside-menu">
        <img src="./assets/svg/Logo.svg" alt="Logo" class="asideLogo">

        <ul id="navLinks">
            <a href="./dashboard/individual-joao.html" class="outros">
                <li>
                    <img src="../assets/svg/alert-svgrepo-com.svg" alt="Alerta">
                    <span>Alertas</span>
                </li>
            </a>

            <a href="./dashboard/dash-diretor.html" class="outros">
                <li>
                    <img src="./assets/svg/dashboard-svgrepo-com.svg" alt="Dashboard">
                    <span>Dashboard</span>
                </li>
            </a>

            <a href="./dashboard/dash-conexoes-ativas.html" class="outros">
                <li>
                    <img src="../assets/svg/icons-marcelo.svg" alt="Chamados">
                    <span>Conexões Ativas</span>
                </li>
            </a>

            <a href="./espec-servidores.html" class="outros">
                <li>
                    <img src="./assets/svg/servidor.svg" alt="Rede">
                    <span>Servidores</span>
                </li>
            </a>

            <a href="./funcionario-diretor.html" class="outros">
                <li>
                    <img src="./assets/svg/user-svgrepo-com.svg" alt="Usuário">
                    <span>Funcionários</span>
                </li>
            </a>

            <a href="./metricas.html" class="outros">
                <li>
                    <img src="./assets/svg/icon - metricas.svg" alt="Chamados">
                    <span>Métricas</span>
                </li>
            </a>

            <a href="./dashboard-cpu-diretor.html" class="outros">
                <li>
                    <img src="./assets/svg/cpu.svg" alt="CPU">
                    <span>Uso CPU</span>
                </li>
            </a>

            <a onclick="limparSessao()" class="outros">
                <li>
                    <img src="../assets/svg/exit-svgrepo-com.svg" alt="Saída">
                    <span>Sair</span>
                </li>
            </a>

        </ul>
        <div class="menu" id="menu-hamburguer">
            <div class="menu" id="menu-hamburguer">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="80px" height="10px"
                    class="hamburger-line">
                    <rect x="0" y="8" width="600" height="10" fill="white"></rect> <!-- Aumentar a altura aqui -->
                </svg>

                <!-- Linha 2 -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="80px" height="10px"
                    class="hamburger-line">
                    <rect x="0" y="24" width="600" height="10" fill="white"></rect> <!-- Aumentar a altura aqui -->
                </svg>

                <!-- Linha 3 -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="80px" height="10px"
                    class="hamburger-line">
                    <rect x="0" y="40" width="600" height="10" fill="white"></rect> <!-- Aumentar a altura aqui -->
                </svg>
            </div>

        </div>

    </aside>
    <div id="fade" class="hide"></div>

    <main>

        <div class="todo">

            <div class="cabecalho-funcionario">
                <h2>Funcionários</h2>

                <a href="./cadastrar-funcionario.html"><button class="cadastroTecnico ">Cadastrar
                        Técnico</button></a>

            </div>

            <section class="funcionarios">
                <article class="lista" id="lista">

                    <!-- <div class="frameFuncionarios">
                        <div class="userImg">
                            <img src="./assets/svg/user.svg" alt="">
                        </div>
                    <p>Fernando Silva</p>
                    <p>Email: fernando.silva@email.com</p>
                    <p>Status: <span class="status-ativo">Ativo</span></p>
                </div>
                <div class="frameFuncionarios">
                    <div class="userImg">
                        <img src="./assets/svg/user.svg" alt="">
                    </div>
                    <p>Fernando Silva</p>
                    <p>Email: fernando.silva@email.com</p>
                    <p>Status: <span class="status-ativo">Ativo</span></p>
                </div>
                <div class="frameFuncionarios">
                    <div class="userImg">
                        <img src="./assets/svg/user.svg" alt="">
                    </div>
                    <p>Fernando Silva</p>
                    <p>Email: fernando.silva@email.com</p>
                    <p>Status: <span class="status-ativo">Ativo</span></p>
                </div>
                <div class="frameFuncionarios">
                    <div class="userImg">
                        <img src="./assets/svg/user.svg" alt="">
                    </div>
                    <p>Fernando Silva</p>
                    <p>Email: fernando.silva@email.com</p>
                    <p>Status: <span class="status-ativo">Ativo</span></p>
                </div>
                <div class="frameFuncionarios">
                    <div class="userImg">
                        <img src="./assets/svg/user.svg" alt="">
                    </div>
                    <p>Fernando Silva</p>
                    <p>Email: fernando.silva@email.com</p>
                    <p>Status: <span class="status-ativo">Ativo</span></p>
                </div>
                <div class="frameFuncionarios">
                    <div class="userImg">
                        <img src="./assets/svg/user.svg" alt="">
                    </div>
                    <p>Fernando Silva</p>
                    <p>Email: fernando.silva@email.com</p>
                    <p>Status: <span class="status-ativo">Ativo</span></p>
                </div> -->

                </article>

                <article class="cadastro">
                    <div class="card" id="informacao">
                        <!-- <h1>Fernando Silva</h1>
                    <hr>
                    <div>
                        <p>Email: fernando.silva@email.com</p>
                        <p>Senha: ************* </p>
                        <p>Status: <span class="status-ativo">Ativo</span></p> -->
                    </div>
                    <!-- <div class="buttons">
                    <button class="btn1" id="btnDesativar">Desativar</button>
                    <button class="btn2" id="btnAlterar">Alterar</button>
                </div> -->
                </article>


                <!-- Modal 1 (Desativar) -->
                <!-- <div id="modal1" class="modal">
                <div class="modal-content1">
                    <div class="modal-header1">
                        <h2>Desativar</h2>
                        <span class="close">&times;</span>
                    </div>
                    <div class="modal-body1">
                        <p><strong>Tem certeza que deseja desativar o perfil?</strong></p>
                    </div>
                    <div class="modal-footer1">
                        <button class="Mf1-Btn1">Cancelar</button>
                        <button class="Mf1-Btn2">Sim</button>
                        
                    </div>
                </div>
            </div> -->


                <!-- Modal 2 (Alterar) -->
                <div id="modal2" class="modal">
                    <div class="modal-content2">
                        <div class="modal-header2">
                            <h2>Fernando Silva</h2>
                            <span class="close">&times;</span>
                        </div>
                        <div class="modal-body2">
                            <label for="">Email:</label>
                            <input type="text" name="emailModal" id="UserEmail" placeholder="fernando.silva@email.com">
                            <label>Senha: </label>
                            <input type="password" name="senhaModal" id="UserSenha" placeholder="*************">
                        </div>
                        <div class="modal-footer2">
                            <button class="salvar-btn">Salvar</button>
                        </div>
                    </div>
                </div>

            </section>

            <!-- <section class="chamados">
            <article class="alertas" id="chamadoCardapio">
                <h2>Chamados Recentes</h2>
                <div class="frameAlertas">
                    <div class="userImg">
                        <img src="./assets/svg/alerta.svg" alt="">
                    </div>
                    <p><span class="status-alerta">Alerta CPU</span></p>
                    <p>Status: <span class="status-ativo">Ativo</span></p>
                    <p>Responsável: Fernando Silva</p>
                    <div class="hrDt">
                        <p>12:13</p>
                        <p>20/09/2024</p>
                    </div>

                </div>
                <div class="frameAlertas">
                    <div class="userImg">
                        <img src="./assets/svg/alerta.svg" alt="">
                    </div>
                    <p><span class="status-alerta">Alerta CPU</span></p>
                    <p>Status: <span class="status-ativo">Ativo</span></p>
                    <p>Responsável: Fernando Silva</p>
                    <div class="hrDt">
                        <p>12:13</p>
                        <p>20/09/2024</p>
                    </div>
                    
                </div>
                <div class="frameAlertas">
                    <div class="userImg">
                        <img src="./assets/svg/alerta.svg" alt="">
                    </div>
                    <p><span class="status-alerta">Alerta CPU</span></p>
                    <p>Status: <span class="status-ativo">Ativo</span></p>
                    <p>Responsável: Fernando Silva</p>
                    <div class="hrDt">
                        <p>12:13</p>
                        <p>20/09/2024</p>
                    </div>
                    
                </div>
            </article>
        </section> -->

        </div>
    </main>
</body>

</html>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const menuHamburguer = document.getElementById('menu-hamburguer');
        const navLinks = document.getElementById('navLinks');

        // Alterna a classe "active" no menu de navegação
        menuHamburguer.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            menuHamburguer.classList.toggle('open');
        });

        // Função para abrir o modal específico
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        // Função para fechar o modal específico
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Abrir o modal de Desativar
        // document.getElementById('btnDesativar').onclick = function () {
        //     desativar()
        // };

        // Abrir o modal de Alterar
        document.getElementById('btnAlterar').onclick = function () {
            openModal('modal2');
        };

        // Fechar modais
        const closeButtons = document.querySelectorAll('.close');
        closeButtons.forEach(button => {
            button.onclick = function () {
                const modal = this.closest('.modal');
                modal.style.display = 'none';
            };
        });

        // Fechar ao clicar fora do modal
        window.onclick = function (event) {
            const modal1 = document.getElementById('modal1');
            const modal2 = document.getElementById('modal2');
            if (event.target === modal1) {
                closeModal('modal1');
            } else if (event.target === modal2) {
                closeModal('modal2');
            }
        };
    });

    function listarFuncionarios() {
        var idEmpresa = sessionStorage.FK_EMPRESA;
        var lista = document.getElementById("lista");
        fetch(`usuarios/listar/${idEmpresa}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta) {
            resposta.json().then(function (resposta) {
                resposta.forEach(element => {
                    let frameFuncionarios = document.createElement("div");
                    frameFuncionarios.className = "frameFuncionarios";

                    let userImg = document.createElement("div");
                    userImg.className = "userImg"
                    userImg.innerHTML = "<img src='./assets/svg/user.svg' alt=''>"
                    let nome = document.createElement("p");
                    nome.innerHTML = element.nome;
                    nome.style.fontWeight = 550;

                    let email = document.createElement("p");
                    // email.style.fontWeight = 800;
                    email.innerHTML = "Email: " + element.email;


                    let status = document.createElement("p");
                    status.innerHTML = "Status: ";
                    let respostaStatus = document.createElement("span");
                    respostaStatus.innerHTML = element.situacao;
                    status.appendChild(respostaStatus);

                    if (element.situacao === "Ativo") {
                        respostaStatus.style.color = "#029c5e";
                        respostaStatus.style.fontWeight = 800;
                    } else if (element.situacao === "Inativo") {
                        respostaStatus.style.color = "#";
                        respostaStatus.style.fontWeight = 500;

                    }

                    frameFuncionarios.appendChild(userImg);
                    frameFuncionarios.appendChild(nome);
                    frameFuncionarios.appendChild(email);
                    frameFuncionarios.appendChild(status);
                    lista.appendChild(frameFuncionarios);
                    frameFuncionarios.onclick = function () {
                        selecionarFunc(element.idUsuario)
                    }
                });
            });
        });
    }

    function selecionarFunc(idUsuario) {
        var informacao = document.getElementById("informacao")

        fetch(`usuarios/buscarPorId/${idUsuario}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"

            }
        }).then(function (resposta) {
            resposta.json().then(function (resposta) {
                console.log(resposta)
                var status = document.createElement("p")
                var senha = document.createElement("p")
                informacao.innerHTML = `<h1>${resposta[0].nome}</h1>
                <hr>
                <div>
                    <p>Email: ${resposta[0].email}</p>
                    <p>Cargo: ${resposta[0].tipo}</p>
                    `
                status.innerHTML = `Status: `
                var respostaStatus = document.createElement("span")
                informacao.appendChild(status)
                status.appendChild(respostaStatus)
                respostaStatus.innerHTML = resposta[0].situacao
                var buttons = document.createElement("div")
                if (resposta[0].situacao == "Ativo") {
                    respostaStatus.style.color = "#029c5e";
                    respostaStatus.style.fontWeight = 700;
                    informacao.appendChild(buttons)
                }
                if (resposta[0].situacao == "inativo") {
                    respostaStatus.style.color = "#6e6e6e";
                    respostaStatus.style.fontWeight = 500;
                }
                buttons.className = "buttons"
                buttons.innerHTML = `<button class='btn1' id='btnDesativar' onclick = desativarFunc(${resposta[0].idUsuario}) style ="color: white">Desativar</button>`
                buttons.innerHTML += `<button class='btn2' id='btnAlterar' onclick = alterarFunc(${resposta[0].idUsuario}) style ="color: white">Alterar</button>`


            })
        })
    }

    function desativarFunc(idUsuario) {
        Swal.fire({
            title: "Inativar Funcionário?",
            text: "Tem certeza que quer inativar esse funcionário?",
            icon: "question",
            iconColor: "#000",
            showCancelButton: true,
            confirmButtonColor: "#05a65d",
            cancelButtonColor: "#d33",
            confirmButtonText: "Sim",
            cancelButtonText: "Cancelar"
        }).then((result) => {
            if (result.isConfirmed) {
                fetch(`/usuarios/desativarFunc/${idUsuario}`, {
                    method: "DELETE",
                    headers: {
                        "Content-Type": "application/json"
                    }
                }).then(function (resposta) {
                    if (resposta.ok) {
                        Swal.fire({
                            title: "Desativado!",
                            text: "O funcionário foi Inativado",
                            icon: "success",
                            confirmButtonColor: "#05a65d",
                            timer: 1000,
                            timerProgressBar: true,
                        }).then(() => {
                            location.reload(); // Recarregar a página após o alerta
                        });
                    }
                    else {
                        Swal.fire({
                            title: "Erro!",
                            text: "Houve um erro em inativar o funcionário.",
                            icon: "error",
                            confirmButtonColor: "#05a65d"
                        });
                    }
                })

            }
        }).catch(function () {
            Swal.fire({
                title: "Erro!",
                text: "Houve um erro em inativar o funcionário.",
                icon: "error"
            });
        })


    }

    function alterarFunc(idUsuario) {
        fetch(`usuarios/buscarPorId/${idUsuario}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"

            }
        }).then(function (resposta) {
            resposta.json().then(function (resposta) {
                let nome = resposta[0].nome
                let email = resposta[0].email
                let senha = resposta[0].senha
                const senhaOculta = senha.replace(/./g, '*');
                Swal.fire({
                    title: "Alterar Funcionário",
                    html: `
                    <div style="display: flex; flex-direction: column; gap: 15px; width: 100%;">
    <label style="color: #000; font-size: 20px; text-align: start;">
        Nome:
        <input type="text" style="color: #000; font-size: 20px; height: 30px; width: 100%;" id="nomeInput" value="${nome}">
    </label>
    <label style="color: #000; font-size: 20px; text-align: start;">
        Email:
        <input type="email" style="color: #000; font-size: 20px; height: 30px; width: 100%;" id="emailInput" value="${email}">
    </label>
    <label style="color: #000; font-size: 20px; text-align: start;">
        Senha:
        <input type="password" style="color: #000; font-size: 20px; height: 30px; width: 100%;" id="senhaInput" value="${senha}">
    </label>
</div>
                        `,
                    showCancelButton: true,
                    confirmButtonText: "Alterar",
                    confirmButtonColor: "#E9C60C",
                    cancelButtonColor: "#d33",
                    cancelButtonText: "Cancelar",
                    reverseButtons: true
                }).then(function (resposta) {
                    if (resposta.isConfirmed) {
                        let nomeInput = document.getElementById("nomeInput").value || nome;
                        let emailInput = document.getElementById("emailInput").value || email;
                        let senhaInput = document.getElementById("senhaInput").value || senha;

                        if (nomeInput.length < 3) {
                            Swal.fire({
                                // title: "Erro!",
                                text: "O nome deve possuir pelo menos 3 caracteres",
                                // icon: "error",
                                confirmButtonColor: "#05a65d"
                            });
                            // alert("O nome deve possuir pelo menos 3 caracteres");
                        } else if (emailInput.indexOf('@') < 0) {
                            Swal.fire({
                                // title: "Erro!",
                                text: "O e-mail precisa conter @",
                                // icon: "error",
                                confirmButtonColor: "#05a65d"
                            });
                            // alert('O e-mail precisa conter @.');
                        } else if (senhaInput.length < 5) {
                            Swal.fire({
                                // title: "Erro!",
                                text: "A senha deve possuir pelo menos 5 caracteres",
                                // icon: "error",
                                confirmButtonColor: "#05a65d"
                            });
                            // alert("A senha deve possuir pelo menos 5 caracteres");
                        }
                        else {
                            fetch("/usuarios/alterarFunc", {
                                method: "PUT",
                                headers: {
                                    "Content-Type": "application/json"
                                },
                                body: JSON.stringify({
                                    nome: nomeInput,
                                    email: emailInput,
                                    senha: senhaInput,
                                    idUsuario: idUsuario
                                })
                            }).then(function (resposta) {
                                if (resposta.ok) {
                                    Swal.fire({
                                        title: "Sucesso!",
                                        text: "Alteração Realizada",
                                        icon: "success",
                                        confirmButtonColor: '#4CAF50',
                                        timer: 1000,
                                        timerProgressBar: true,
                                    }).then(() => {
                                        location.reload(); // Recarregar a página após o alerta
                                    });

                                    // errorMessage.innerHTML = "Cadastro realizado com sucesso! Redirecionando...";
                                    // alert("Cadastro realizado com sucesso! Redirecionando...")
                                    // setTimeout(() => {
                                    //     window.location = "funcionario-diretor.html";
                                    // }, 2000);
                                } else {
                                    errorMessage.style.display = "block";
                                    Swal.fire({
                                        title: "Erro!",
                                        text: "Houve um erro ao tentar realizar o cadastro!",
                                        icon: "error",
                                        confirmButtonColor: '#f44336', // Cor vermelha do botão
                                        timer: 2000, // Tempo antes de fechar automaticamente
                                        timerProgressBar: true
                                    });
                                    // errorMessage.innerHTML = "Houve um erro ao tentar realizar o cadastro!";
                                }
                            }

                            )
                        }

                    }
                })

            })
        })
    }
    // function listarChamados() {
    //         var dataAtual = new Date()
    //         var idDiretor = sessionStorage.ID_USUARIO
    //         fetch('/chamados/listarPorDiretor', {
    //             method: "POST",
    //             headers: {
    //                 "Content-Type": "application/json",
    //             },
    //             body: JSON.stringify({
    //                 idDiretor: idDiretor
    //             })
    //         }).then(function (resposta) {
    //             resposta.json().then(function (resposta) {
    //                 console.log("Dados encontrados:", resposta)
    //                 resposta.forEach(element => {
    //                     var base = document.getElementById("chamadoCardapio")
    //                     var data = new Date(element.dtHora)
    //                     var dataDia = data.getDate()
    //                     var dataMes = data.getMonth()+1
    //                     var dataAno = data.getFullYear()
    //                     var dataHoras = data.getHours()
    //                     var dataMinutos = data.getMinutes()
    //                     var horas = `${adicionarZero(dataHoras)}:${adicionarZero(dataMinutos)}`
    //                     var date = `${adicionarZero(dataDia)}/${adicionarZero(dataMes)}/${adicionarZero(dataAno)}`

    //                     if(dataDia === dataAtual.getDate() && dataMes === dataAtual.getMonth()+1 && dataAno === dataAtual.getFullYear())
    //                 {
    //                     base.appendChild(chamado)
    //                     var frameAlertas = document.createElement("div")
    //                     frameAlertas.className = "frameAlertas"
    //                     var status = document.createElement("p")
    //                     status.innerHTML = "Status"
    //                     var statusResposta = document.createElement("span")
    //                     statusResposta.innerHTML = element.situacao

    //                     if(element.situacao == "Atendido")
    //                 }
    //             }
    //                 );
    //             })
    //         })
    //             .catch(function (error) {
    //                 console.log("#ERROR:", error)
    //             })
    //     }
    function adicionarZero(numero) {
        return (numero < 10 ? '0' : '') + numero;
    }



</script>