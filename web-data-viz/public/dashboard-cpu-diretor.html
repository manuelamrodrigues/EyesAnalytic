<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard CPU | EyesAnalytic</title>
    <script src="../js/aside-menu.js"></script>
    <link rel="shortcut icon" href="./assets/svg/Logo.svg" type="image/x-icon">
    <link rel="stylesheet" href="./css/pages/dashboard-cpu-diretor.css">
    <link rel="stylesheet" href="./css/pages/aside-menu.css">
    <!-- <link rel="stylesheet" href="./css/pages/espec-servidores.css"> -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body onload="listarServidores()">
    <aside id="aside-menu">
        <img src="../assets/svg/Logo.svg" alt="Logo" class="asideLogo">

        <ul id="navLinks">
            <a href="../lista-alertas.html" class="outros">
                <li>
                    <img src="../assets/svg/alert-svgrepo-com.svg" alt="Alerta">
                    <span>Alertas</span>
                </li>
            </a>

            <a href="../dashboard/dash-diretor.html" class="outros">
                <li>
                    <img src="../assets/svg/dashboard-svgrepo-com.svg" alt="Dashboard">
                    <span>Dashboard</span>
                </li>
            </a>

            <a href="../espec-servidores.html" class="outros">
                <li>
                    <img src="../assets/svg/servidor.svg" alt="Rede">
                    <span>Servidores</span>
                </li>
            </a>

            <a href="../funcionario-diretor.html" class="outros">
                <li>
                    <img src="../assets/svg/user-svgrepo-com.svg" alt="Usuário">
                    <span>Funcionários</span>
                </li>
            </a>

            <a href="../metricas-diretor.html" class="outros">
                <li>
                    <img src="../assets/svg/chamados.svg" alt="Chamados">
                    <span>Métricas</span>
                </li>
            </a>

            <a href="./index.html" class="outros">
                <li>
                    <img src="../assets/svg/exit-svgrepo-com.svg" alt="Saída">
                    <span>Sair</span>
                </li>
            </a>

        </ul>
        <div class="menu" id="menu-hamburguer">
            <div class="menu" id="menu-hamburguer">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="80px" height="10px"
                    class="hamburger-line">
                    <rect x="0" y="8" width="600" height="10" fill="white"></rect> <!-- Aumentar a altura aqui -->
                </svg>

                <!-- Linha 2 -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="80px" height="10px"
                    class="hamburger-line">
                    <rect x="0" y="24" width="600" height="10" fill="white"></rect> <!-- Aumentar a altura aqui -->
                </svg>

                <!-- Linha 3 -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="80px" height="10px"
                    class="hamburger-line">
                    <rect x="0" y="40" width="600" height="10" fill="white"></rect> <!-- Aumentar a altura aqui -->
                </svg>
            </div>

        </div>

        </div>
    </aside>
    <div id="fade" class="hide"></div>

    <main>
        <h1>Uso de CPU</h2>
            <section class="chamados" id="conteudo">
                <article class="alertas" id="lista">
                </article>

                <div id="conteudoServidores" class="conteudoServidores">
                    <h3 class="tituloServidores">Servidores em Sobrecarga</h3>
                </div>

                <div id="modal" class="modal">
                </div>

            </section>

            <section>
                <div>
                    <canvas class="grafico_media_max" id="myChart"></canvas>
                    <!-- <canvas class="grafico_media_max" id="myChart" width="100" height="20" style="box-sizing: border-box;height: 607px;width: 20px;"></canvas> -->
                </div>
            </section>

            <section>
                <div>
                    <canvas class="grafico_media_max" id="myChart2"></canvas>
                    <!-- <canvas class="grafico_media_max" id="myChart" width="100" height="20" style="box-sizing: border-box;height: 607px;width: 20px;"></canvas> -->
                </div>
            </section>
    </main>
</body>

</html>
<script>

    //FUNÇÃO PARA LISTAR TODOS OS SERVIDORES DE UMA DETERMINADA EMPRESA
    function listarServidores() {
        var fkEmpresa = sessionStorage.FK_EMPRESA;
        var lista = document.getElementById("lista");

        fetch(`servidor/listarPorUsoCPU/${fkEmpresa}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta) {
            resposta.json().then(function (resposta) {
                resposta.forEach(element => {
                    let openModal = document.createElement("div");
                    openModal.className = "openModal";

                    let frameAlertas = document.createElement("div");
                    frameAlertas.className = "frameAlertas";

                    let abrir = document.createElement("div");
                    abrir.className = "abrir";
                    abrir.id = "openModal";
                    abrir.onclick = function () {
                        listarEspecifico(element.idMaquina);
                    };

                    let titulo = document.createElement("h3");
                    // titulo.onclick = function () {
                    //     listarEspecifico(element.idMaquina);
                    // };
                    titulo.innerText = element.nomeMaquina;

                    // Adicionando opções de CPU, Memória e Disco
                    let opcoes = document.createElement("div");
                    opcoes.className = "opcoes";
                    // opcoes.onclick = function () {
                    //     listarEspecifico(element.idMaquina);
                    // };

                    // CPU
                    let opcaoCPU = document.createElement("div");
                    opcaoCPU.className = "opcao";
                    opcaoCPU.innerHTML = "<h4>CPU:</h4><p>" + (element.CPU || "N/A") + "%</p>";

                    // Memória
                    let opcaoMemoria = document.createElement("div");
                    opcaoMemoria.className = "opcao";
                    opcaoMemoria.innerHTML = "<h4>Memória:</h4><p>" + (element.Memoria || "N/A") + "%</p>";

                    // Disco
                    let opcaoDisco = document.createElement("div");
                    opcaoDisco.className = "opcao";
                    opcaoDisco.innerHTML = "<h4>Disco:</h4><p>" + (element.Disco || "N/A") + "%</p>";

                    // Adicionando opções à div 'opcoes'
                    opcoes.appendChild(opcaoCPU);
                    opcoes.appendChild(opcaoMemoria);
                    opcoes.appendChild(opcaoDisco);

                    // Montando o conteúdo do modal
                    abrir.appendChild(titulo);
                    abrir.appendChild(opcoes);
                    frameAlertas.appendChild(abrir);
                    openModal.appendChild(frameAlertas);

                    // Adicionando o modal completo ao DOM
                    document.body.appendChild(openModal);

                });
            });
        })
    }

    const ctx = document.getElementById('myChart');
    var color1 = '#0BA385';  // Primeira cor (ex: vermelho)
    var color2 = '#CE1919';  // Segunda cor (ex: azul)

    var labels = ['Média', 'Máximo', 'Média', 'Máximo', 'Média', 'Máximo', 'Média', 'Máximo', 'Média', 'Máximo', 'Média', 'Máximo', 'Média', 'Máximo'];
    var data = [10, 20, 30, 40, 50, 10, 20, 30, 40, 50, 10, 20, 30, 40];

    // Criar o array de `backgroundColor` alternando entre as cores
    var backgroundColors = [];
    data.forEach((value, index) => {
        // Alterna entre color1 e color2 baseado no índice
        if (index % 2 === 0) {
            backgroundColors.push(color1);  // Cor 1 para índices pares
        } else {
            backgroundColors.push(color2);  // Cor 2 para índices ímpares
        }
    });

    var borderColors = backgroundColors.map(color => color.replace('0.2', '1'));

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Uso de CPU',
                data: data,
                borderWidth: 1,
                backgroundColor: backgroundColors,  // Array com cores alternadas
                borderColor: borderColors
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });


    var color1 = '#0BA385';  // Primeira cor (ex: vermelho)
    var color2 = '#CE1919';  // Segunda cor (ex: azul)

    var labels = ['Média', 'Máximo', 'Média'];
    var data = [10, 20, 30];

    var backgroundColors = [];


    data.forEach((value, index) => {
        // Alterna entre color1 e color2 baseado no índice
        if (index % 2 === 0) {
            backgroundColors.push(color1);  // Cor 1 para índices pares
        } else {
            backgroundColors.push(color2);  // Cor 2 para índices ímpares
        }
    });

    var borderColors = backgroundColors.map(color => color.replace('0.2', '1'));
    const ctx2 = document.getElementById('myChart2');
    new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Uso de CPU',
                data: data,
                borderWidth: 1,
                backgroundColor: backgroundColors,  // Array com cores alternadas
                borderColor: borderColors
            }]
        },
        options: {
            responsive: true,
            indexAxis: 'y',
            x: {
                stacked: true
            },
            y: {
                stacked: true
            }
        }
    
    });
</script>